<!DOCTYPE html>
<html lang="en" >

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<title>Totalizator</title>
</head>



<style>
body{
position: absolute;
width: 646px;
height:320px; 
font-family: 'Roboto', sans-serif;
}

svg {
width: 100%;
height: 100%;
left: 0;
}

instrument{
position: absolute;
}
</style>

<body>
<svg>
    <rect width="100%" height="100%" style="opacity:0"></rect>
</svg>

<script>
var width = 646;
var height = 300;

var vertMult = 10;
var horizMult = 34;

var horizShift = 20;

var data;

var daysAmount = 16;
var minValue = 23;//.70;
var maxValue = 46+1;//.46;
var firstDay = "22 декабря";
var lastDay = "20 января";

d3.json("Stat.json", function(data) {
  drawBackground(data);
});

d3.json("Totalizator.json", function(data) {
  drawData(data);
});

d3.select("svg").selectAll("rect")
.on("click", function(){
d3.selectAll("g").remove();
});

function drawBackground (data){


d3.select("svg").append("text")
.attr("font-weight",800)
.attr("font-size",14)
.text(firstDay)  
.attr("x",horizShift+3)
.attr("y",height + 15);

d3.select("svg").append("text")
.attr("font-weight",800)
.attr("font-size",14)
.text(lastDay)  
.attr("x",width-70)
.attr("y",height + 15);


for (i=0;i<daysAmount+3;i++)
{
  d3.select("svg").append("line")
  .attr("x1",horizShift + i*width/(daysAmount+2))
  .attr("x2",horizShift + i*width/(daysAmount+2))
  .attr("y1",50)
  .attr("y2",height)//1035)
  .attr("stroke-width",1)
  .attr("stroke","#000000")
  .attr("opacity",0.3);
}


for (j=0;j<(maxValue-minValue)+5;j=j+5)
{
  d3.select("svg").append("line")
  .attr("x1",0)
  .attr("x2",width)
  .attr("y1",height - vertMult*(j))
  .attr("y2",height - vertMult*(j))
  .attr("stroke-width",1)
  .attr("stroke","#000000")
  .attr("opacity",0.3);

  d3.select("svg").append("text")
  .attr("x",0)
  .attr("y",height - vertMult*(j) - 4)
  .attr("font-weight",800)
  .attr("font-size",12)
  .attr("opacity",0.5)
  .text(minValue+j);
}

} 


function drawData (data){

var circle = d3.select("svg").selectAll("c")
.data(data).enter()
//.append("a")
//.attr("xlink:href", function(d) {return "#"+d.link})
.append("circle")
//.attr("id",function(d,i) {return "circle"+shift+d.globalcntr})
//.attr("stroke-width",0.5)
//.attr("stroke","#222222")
.attr("fill","#27aae1")
.attr("opacity",0.9)
.attr("r", 10)
.on("mouseover", function(d,i){d3.select(this).transition().attr("r",15).duration(150)})
.on("mouseout", function(d,i){d3.select(this).transition().attr("r",10).duration(150)})
.attr("cx",function(d){return horizShift + d.Date*width/(16+2)+d.Time*width/(16+2)/24})
.attr("cy",function(d){return height-vertMult*(d.Value-minValue)})
.on("click", function(d){drawDetails(horizShift + d.Date*width/(16+2)+d.Time*width/(16+2)/24,height-vertMult*(d.Value-minValue),d.Name,d.Company,d.Value)});

}

function drawDetails (x,y,name,company,value){

  if (x > (width/2))
  {
    x = x-200;
  }

  if (y > (height/2))
  {
    y = y-85;
  }


  d3.selectAll("g").remove();

  var group=d3.select("svg").append("g");

  var rectangle=group.append("rect")
  .attr("x",x)
  .attr("y",y)
  .attr("rx",3)
  .attr("ry",3)
  .attr("width",200)
  .attr("height",85)
  .attr("fill","#007eb3");
//  .attr("stroke","#ffffff")
//  .attr("stroke-width",1);

var name=group.append("text")
.text(name)
.attr("width",180)
.attr("height",100)
//.attr("style","letter-spacing:1;")
.attr("x",x+15)
.attr("y",y+25)
.attr("fill","#ffffff")
.attr("font-weight",500)
.attr("font-size","16");

var name=group.append("text")
.text(company)
.attr("width",180)
.attr("height",100)
.attr("x",x+15)
.attr("y",y+40)
.attr("fill","#ffffff")
.attr("font-weight",200)
.attr("font-size","12");


var value=group.append("text")
.text(value)
.attr("width",180)
.attr("height",100)
//.attr("style","letter-spacing:1;")
.attr("x",x+15)
.attr("y",y+70)
.attr("fill","#ffffff")
.attr("font-weight",700)
.attr("font-size","28");


}


</script>

</body>
</html>